<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WIP Write-Off Tool (Simple)</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f5f5f5;
    }

    label {
        font-size: 14px;
        margin-right: 8px;
    }

    input[type="text"], input[type="number"] {
        padding: 6px 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
        width: 180px;
    }

    button {
        padding: 6px 12px;
        border: none;
        background: #0078d4;
        color: white;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
    }

    button:hover {
        background: #005ea3;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        background: white;
    }

    th, td {
        padding: 6px 10px;
        border: 1px solid #ddd;
        font-size: 14px;
    }

    th {
        background: #e8eef5;
    }

    .right { text-align: right; }

    #jsonOutput {
        margin-top: 20px;
        padding: 12px;
        background: #fff;
        border: 1px solid #ccc;
        border-radius: 4px;
        white-space: pre-wrap;
        font-family: Consolas, monospace;
        display: none;
    }
</style>
</head>
<body>

<h2>WIP Write-Off Tool</h2>

<!-- Name -->
<div style="margin-bottom: 10px;">
    <label>Name:</label>
    <input type="text" id="partnerName" placeholder="Enter your name">
</div>

<!-- Add client -->
<div style="margin-bottom: 10px;">
    <label>Client Add:</label>
    <button id="addClientBtn">Add Client</button>
</div>

<!-- Table -->
<table id="clientTable">
    <thead>
        <tr>
            <th>Client</th>
            <th class="right">Net WIP</th>
            <th class="right">Fee</th>
            <th class="right">Write Off</th>
        </tr>
    </thead>
    <tbody id="clientRows">
        <!-- rows will be injected -->
    </tbody>
    <tfoot>
        <tr>
            <th>Total Clients:</th>
            <th class="right" id="totalWip">0.00</th>
            <th class="right" id="totalFee">0.00</th>
            <th class="right" id="totalWrite">0.00</th>
        </tr>
    </tfoot>
</table>

<!-- Submit -->
<div style="margin-top: 20px;">
    <button id="submitBtn">Submit</button>
</div>

<!-- JSON Output -->
<div id="jsonOutput"></div>

<script>
    const tbody = document.getElementById("clientRows");
    const addBtn = document.getElementById("addClientBtn");
    const submitBtn = document.getElementById("submitBtn");

    const totalWipEl = document.getElementById("totalWip");
    const totalFeeEl = document.getElementById("totalFee");
    const totalWriteEl = document.getElementById("totalWrite");

    function addRow() {
        const tr = document.createElement("tr");

        tr.innerHTML = `
            <td><input type="text" class="client-name" placeholder="Client name"></td>
            <td class="right"><input type="number" class="net-wip" min="0" step="0.01" value="0"></td>
            <td class="right"><input type="number" class="fee" min="0" step="0.01" value="0"></td>
            <td class="right"><input type="number" class="writeoff" readonly></td>
        `;

        const netWipInput = tr.querySelector('.net-wip');
        const feeInput = tr.querySelector('.fee');

        function recalc() {
            const wip = parseFloat(netWipInput.value) || 0;
            const fee = parseFloat(feeInput.value) || 0;
            const write = Math.max(wip - fee, 0);

            tr.querySelector('.writeoff').value = write.toFixed(2);

            recalcTotals();
        }

        netWipInput.addEventListener("input", recalc);
        feeInput.addEventListener("input", recalc);

        tbody.appendChild(tr);
        recalc();
    }

    function recalcTotals() {
        let totalWip = 0;
        let totalFee = 0;
        let totalWrite = 0;

        [...tbody.querySelectorAll("tr")].forEach(row => {
            totalWip += parseFloat(row.querySelector(".net-wip").value) || 0;
            totalFee += parseFloat(row.querySelector(".fee").value) || 0;
            totalWrite += parseFloat(row.querySelector(".writeoff").value) || 0;
        });

        totalWipEl.textContent = totalWip.toFixed(2);
        totalFeeEl.textContent = totalFee.toFixed(2);
        totalWriteEl.textContent = totalWrite.toFixed(2);
    }

    function buildJSON() {
        const name = document.getElementById("partnerName").value.trim();
        const date = new Date().toISOString();

        const clients = [];

        [...tbody.querySelectorAll("tr")].forEach(row => {
            const client = row.querySelector(".client-name").value.trim();
            const wip = parseFloat(row.querySelector(".net-wip").value) || 0;
            const fee = parseFloat(row.querySelector(".fee").value) || 0;
            const write = parseFloat(row.querySelector(".writeoff").value) || 0;

            if (client) {
                clients.push({ client, fee, writeOff: write });
            }
        });

        return {
            name,
            date,
            clients,
            totals: {
                fee: parseFloat(totalFeeEl.textContent),
                writeOff: parseFloat(totalWriteEl.textContent)
            }
        };
    }

    submitBtn.addEventListener("click", () => {
        const jsonObj = buildJSON();
        const jsonOut = document.getElementById("jsonOutput");

        jsonOut.style.display = "block";
        jsonOut.textContent = JSON.stringify(jsonObj, null, 2);
    });

    addBtn.addEventListener("click", addRow);

    // Start with one blank row
    addRow();
</script>

</body>
</html>
